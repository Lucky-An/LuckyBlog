(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-a74d"],{Ibrk:function(e,t,r){"use strict";r.d(t,"e",function(){return n}),r.d(t,"g",function(){return i}),r.d(t,"i",function(){return l}),r.d(t,"f",function(){return o}),r.d(t,"a",function(){return u}),r.d(t,"b",function(){return s}),r.d(t,"d",function(){return c}),r.d(t,"c",function(){return m}),r.d(t,"h",function(){return d});var a=r("t3Un");function n(e){return Object(a.a)({url:"/api/v1/common/admin/challenge/tags/",method:"get",params:e})}function i(){return Object(a.a)({url:"/api/v1/common/admin/flavors",method:"get",params:{per_page:9999}})}function l(){return Object(a.a)({url:"/api/v1/common/admin/images",method:"get"})}function o(e){return Object(a.a)({url:"/api/v1/common/admin/challenge/categorys/",method:"get",params:e})}function u(e){return Object(a.a)({url:"/api/v1/common/admin/challenge/tags/",method:"post",data:e})}function s(e){return Object(a.a)({url:"/api/v1/common/admin/challenge/categorys/",method:"post",data:e})}function c(e){return Object(a.a)({url:"/api/v1/common/admin/challenge/categorys/",method:"delete",data:e})}function m(e){return Object(a.a)({url:"/api/v1/common/admin/challenge/tags/",method:"delete",data:e})}function d(e){return Object(a.a)({url:"/api/v1/common/admin/flavors",method:"get",params:e})}},Ktrp:function(e,t,r){"use strict";var a=r("X1OI");r.n(a).a},"MD+q":function(e,t,r){"use strict";r.d(t,"e",function(){return n}),r.d(t,"d",function(){return i}),r.d(t,"f",function(){return l}),r.d(t,"k",function(){return o}),r.d(t,"i",function(){return u}),r.d(t,"g",function(){return s}),r.d(t,"h",function(){return c}),r.d(t,"j",function(){return m}),r.d(t,"c",function(){return d}),r.d(t,"b",function(){return f}),r.d(t,"a",function(){return p});var a=r("t3Un");
//! 渗透赛获取题目列表
function n(e){return Object(a.a)({url:"/api/v1/inf/admin/setting/challenge_store_list",method:"get",params:e})}
//! 渗透赛获取题目标签options值
function i(e){return Object(a.a)({url:"/api/v1/inf/admin/setting/challenge_store_flag",method:"get",params:e})}function l(e){return Object(a.a)({url:"/api/v1/inf/admin/setting/challenge_store",method:"post",data:e})}function o(e){return Object(a.a)({url:"/api/v1/inf/admin/setting/challenge_store_list",method:"post",data:e})}
//! 获取题目类型
function u(){return Object(a.a)({url:"/api/v1/inf/admin/setting/categorys",method:"get"})}
//! 获取镜像列表
function s(e){return Object(a.a)({url:"/api/v1/common/admin/images",method:"get",params:e})}function c(e){return Object(a.a)({url:"/api/v1/inf/admin/setting/challenge_store",method:"get",params:e})}function m(e,t){return Object(a.a)({url:"/api/v1/inf/admin/setting/challenge_store",method:"patch",params:e,data:t})}function d(e){return Object(a.a)({url:"/api/v1/inf/admin/setting/challenge_store/test_env/"+e,method:"post"})}function f(e){return Object(a.a)({url:"/api/v1/inf/admin/setting/challenge_store/test_env/"+e,method:"delete"})}function p(e){return Object(a.a)({url:"/api/v1/inf/admin/setting/challenge_store/test_env/"+e,method:"get"})}},Timy:function(e,t,r){"use strict";r.d(t,"f",function(){return n}),r.d(t,"d",function(){return i}),r.d(t,"a",function(){return l}),r.d(t,"b",function(){return o}),r.d(t,"c",function(){return u}),r.d(t,"h",function(){return s}),r.d(t,"e",function(){return c}),r.d(t,"g",function(){return m});var a=r("t3Un");function n(e){return Object(a.a)({url:"/api/v1/att_def/admin/setting/challenge_store_list/",method:"get",params:e})}function i(e){return Object(a.a)({url:"/api/v1/att_def/admin/setting/challenge_store/",method:"post",data:e})}function l(e){return Object(a.a)({url:"/api/v1/att_def/admin/setting/challenge_store_list/",method:"post",data:e})}function o(e){return Object(a.a)({url:"/api/v1/att_def/admin/setting/challenge_store/",method:"get",params:e})}function u(e,t){return Object(a.a)({url:"/api/v1/att_def/admin/setting/challenge_store/",method:"patch",params:e,data:t})}function s(e){return Object(a.a)({url:"/api/v1/att_def/admin/setting/challenge_store/test_env/"+e,method:"post"})}function c(e){return Object(a.a)({url:"/api/v1/att_def/admin/setting/challenge_store/test_env/"+e,method:"delete"})}function m(e){return Object(a.a)({url:"/api/v1/att_def/admin/setting/challenge_store/test_env/"+e,method:"get"})}},X1OI:function(e,t,r){},Y5bG:function(e,t,r){"use strict";r.d(t,"a",function(){return n}),Math.easeInOutQuad=function(e,t,r,a){return(e/=a/2)<1?r/2*e*e+t:-r/2*(--e*(e-2)-1)+t};var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};function n(e,t,r){var n=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,i=e-n,l=0;t=void 0===t?500:t;!function e(){l+=20,function(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}(Math.easeInOutQuad(l,n,i,t)),l<t?a(e):r&&"function"==typeof r&&r()}()}},"sH/c":function(e,t,r){"use strict";r.r(t);var a=r("i8oh"),n=r("tBjE"),i=r("uTCP"),l=r("Timy"),o=r("Ibrk"),u=(r("MD+q"),{components:{UploadFile:n.a,QuillEditor:i.a,ChoiceImage:a.a},data:function(){return{currentFlavor:null,selectMirror:!1,allMirrorList:[],is_image_type:"",image_type_list:[{label:"kvm",value:"kvm"},{label:"docker",value:"docker"},{label:"docker_compose",value:"docker_compose"}],listSelect:{limit:10,offset:1},total:0,search:"",os_type_list:[{label:"windows",value:"windows"},{label:"linux",value:"linux"}],os_type:"",task_id:this.$route.query.task_id,tagAry:[],subType:[],subimages:[],subflavors:[],ruleForm:{title:"",challenge_type:"",label:"",level:0,start_method:0,image_uuid:"",image_name:"",port:80,flavor_uuid:"",flavor_name:"",score:"",attach_file:null,checker_script:null,pushflag_script:null,wp_official:null,attach:null},rules:{title:[{required:!0,message:"请输入题目名称",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字",trigger:"blur"}],image_name:[{required:!0,message:"请输入镜像名称",trigger:"blur"}],port:[{required:!0,message:"请输入端口",trigger:"blur"}],challenge_type:[{required:!0,message:"请选择题目类型",trigger:"change"}],label:[{required:!0,message:"请选择题目标签",trigger:"change"}],start_method:[{required:!0,message:"请选择镜像类型",trigger:"blur"}],flavor_uuid:[{required:!0,message:"请选择实例模板",trigger:"change"}]}}},created:function(){this.getType(),this.getTag(),this.getimages(),this.getflavors(),this.task_id&&this.subInfo()},beforeDestroy:function(){this.$store.dispatch("changeMatchName","")},methods:{cancelSelect:function(){this.is_image_type="",this.search="",this.os_type="",this.selectMirror=!1,this.selectMirrorList=[]},changeSelectedMirrorList:function(e){e.length>1&&(this.$refs.MirrorListTable.clearSelection(),this.$refs.MirrorListTable.toggleRowSelection(e[1]),e.shift()),this.selectMirrorList=e},confirmSelect:function(){this.is_image_type="",this.search="",this.os_type="",this.selectMirror=!1,this.selectMirrorList.length&&(this.ruleForm.image_name=this.selectMirrorList[0].name,this.ruleForm.image_uuid=this.selectMirrorList[0].uuid)},goBack:function(){history.back()},getType:function(){var e=this;Object(o.f)({type:1}).then(function(t){e.subType=t.data})},getimages:function(){var e=this;Object(o.i)().then(function(t){e.subimages=t.data.data})},getflavors:function(){var e=this;Object(o.g)().then(function(t){e.subflavors=t.data.data})},getTag:function(){var e=this;Object(o.e)({type:1}).then(function(t){e.tagAry=t.data})},subInfo:function(){var e=this,t={challenge_id:this.task_id};Object(l.b)(t).then(function(t){for(var r in e.$store.dispatch("changeMatchName",t.data.title),e.ruleForm)e.ruleForm[r]=t.data[r];e.ruleForm.flavor_uuid=t.data.flavor_uuid,e.ruleForm.flavor_name=t.data.flavor_name,e.currentFlavor={uuid:e.ruleForm.flavor_uuid}})},onSubmit:function(){var e=this,t=this.ruleForm,r=new FormData;for(var a in t)r.append(a,t[a]);var n="/itemBank/defense/index";if(this.task_id){var i={challenge_id:this.task_id};Object(l.c)(i,r).then(function(t){t.data.success&&(e.$message.success("操作成功"),e.$router.push({path:n}))}).catch(function(t){e.$message.error(t.response.data.message_zh)})}else Object(l.a)(r).then(function(t){t.data.success&&(e.$message.success("操作成功"),e.$router.push({path:n}))})},flavorChange:function(e){var t=e.name,r=e.uuid;this.ruleForm.flavor_name=t,this.ruleForm.flavor_uuid=r},submitForm:function(){var e=this;this.$refs.ruleForm.validate(function(t){if(!t)return e.$message.error("请核验所填写的信息"),!1;var r={checker_script:"checker 脚本",pushflag_script:"pushflag 脚本",attach_file:"题目附件"};for(var a in r)if(!e.ruleForm[a])return e.$message.error("请上传 "+r[a]),!1;e.onSubmit()})},resetForm:function(){this.$refs.ruleForm.resetFields()},changeImageType:function(){this.ruleForm.image_name="",this.ruleForm.image_uuid=""}}}),s=(r("Ktrp"),r("ZrdR")),c=Object(s.a)(u,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container create_topic"},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"200px"}},[r("el-form-item",{attrs:{label:"题目名称",prop:"title"}},[r("el-input",{attrs:{placeholder:"请输入题目名称"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title","string"==typeof t?t.trim():t)},expression:"ruleForm.title"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"题目类型",prop:"challenge_type"}},[r("el-select",{staticClass:"filter-item",attrs:{placeholder:"请选择题目类型"},model:{value:e.ruleForm.challenge_type,callback:function(t){e.$set(e.ruleForm,"challenge_type",t)},expression:"ruleForm.challenge_type"}},e._l(e.subType,function(e,t){return r("el-option",{key:t,attrs:{label:e.cn_name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"题目标签",prop:"label"}},[r("el-select",{staticClass:"filter-item",attrs:{placeholder:"请选择题目标签"},model:{value:e.ruleForm.label,callback:function(t){e.$set(e.ruleForm,"label",t)},expression:"ruleForm.label"}},e._l(e.tagAry,function(e,t){return r("el-option",{key:t,attrs:{label:e.cn_name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"题目难度"}},[r("el-select",{staticClass:"filter-item",attrs:{placeholder:"请选择题目难度"},model:{value:e.ruleForm.level,callback:function(t){e.$set(e.ruleForm,"level",t)},expression:"ruleForm.level"}},[r("el-option",{key:"1",attrs:{value:0,label:"初级"}}),e._v(" "),r("el-option",{key:"2",attrs:{value:1,label:"中级"}}),e._v(" "),r("el-option",{key:"3",attrs:{value:2,label:"高级"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"镜像类型",prop:"start_method"}},[r("el-select",{staticClass:"filter-item",attrs:{placeholder:"请选择镜像类型"},on:{change:e.changeImageType},model:{value:e.ruleForm.start_method,callback:function(t){e.$set(e.ruleForm,"start_method",t)},expression:"ruleForm.start_method"}},[r("el-option",{attrs:{value:0,label:"Docker"}}),e._v(" "),r("el-option",{attrs:{value:1,label:"KVM"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"镜像选择",required:""}},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.selectMirror=!0}}},[e._v("选择")]),e._v(" "),r("span",[e._v(e._s(e.ruleForm.image_name))])],1),e._v(" "),0==e.ruleForm.start_method?r("el-form-item",{attrs:{label:"题目端口",prop:"port"}},[r("el-input-number",{attrs:{min:0,max:65535,precision:0,placeholder:"默认80端口"},model:{value:e.ruleForm.port,callback:function(t){e.$set(e.ruleForm,"port",t)},expression:"ruleForm.port"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"实例模板",prop:"flavor_uuid"}},[r("el-select",{attrs:{placeholder:"实例模板","value-key":"uuid"},on:{change:e.flavorChange},model:{value:e.currentFlavor,callback:function(t){e.currentFlavor=t},expression:"currentFlavor"}},e._l(e.subflavors,function(e){return r("el-option",{key:e.uuid,attrs:{value:e,label:e.name+" / "+e.vcpus+"核 / "+e.memory+"MB / "+e.disk+"GB"}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"题目分值桶"}},[r("el-input-number",{attrs:{min:-1e4,max:1e5,label:"描述文字"},model:{value:e.ruleForm.score,callback:function(t){e.$set(e.ruleForm,"score",t)},expression:"ruleForm.score"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"checker脚本",required:""}},[r("UploadFile",{attrs:{file:e.ruleForm.checker_script,"file-type":["py"]},on:{"update:file":function(t){e.$set(e.ruleForm,"checker_script",t)}}}),e._v("\n      （请上传py格式文件,大小不超过10M）\n    ")],1),e._v(" "),r("el-form-item",{attrs:{label:"pushflag脚本",required:""}},[r("UploadFile",{attrs:{file:e.ruleForm.pushflag_script,"file-type":["sh"]},on:{"update:file":function(t){e.$set(e.ruleForm,"pushflag_script",t)}}}),e._v("\n      （请上传sh格式文件,大小不超过10M）\n    ")],1),e._v(" "),r("el-form-item",{attrs:{label:"题目附件",required:""}},[r("UploadFile",{attrs:{file:e.ruleForm.attach_file,"file-size":10485760,"file-type":["zip"]},on:{"update:file":function(t){e.$set(e.ruleForm,"attach_file",t)}}}),e._v("\n      （请上传zip格式文件,大小不超过10M）\n      ")],1),e._v(" "),r("el-form-item",{attrs:{label:"赛题WP"}},[r("UploadFile",{attrs:{file:e.ruleForm.wp_official,"file-type":["pdf","docx","md"]},on:{"update:file":function(t){e.$set(e.ruleForm,"wp_official",t)}}}),e._v("\n      （请上传pdf,docx,md格式文件,大小不超过10M）\n    ")],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保存")]),e._v(" "),r("el-button",{attrs:{type:"warning"},on:{click:e.goBack}},[e._v("返回")])],1)],1),e._v(" "),e.selectMirror?r("ChoiceImage",{attrs:{type:0==e.ruleForm.start_method?"docker":"kvm",image_name:e.ruleForm.image_name,image_uuid:e.ruleForm.image_uuid,"select-mirror":e.selectMirror},on:{"update:image_name":function(t){e.$set(e.ruleForm,"image_name",t)},"update:image_uuid":function(t){e.$set(e.ruleForm,"image_uuid",t)},"update:selectMirror":function(t){e.selectMirror=t}}}):e._e()],1)},[],!1,null,null,null);c.options.__file="index.vue";t.default=c.exports}}]);